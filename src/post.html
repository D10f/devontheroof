<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, inital-scale=1.0" />
    <link
      rel="shortcut icon"
      href="../assets/images/favicon.png"
      type="image/png"
    />
    <title>Developer Sojourn | Blog</title>
  </head>
  <body class="post">
    <header id="about" class="section__header">
      <h1 class="section__title section__header--title">
        <a
          aria-label="Back to main page"
          href="http://localhost:8080/blog.html"
        >
          <small aria-label="hidden">&larr;</small>
          Developer Sojourn</a
        >
      </h1>
      <aside class="section__header-search">
        <form class="search-form">
          <input
            class="search-form__input"
            id="search-posts"
            name="text-input"
            type="text"
            placeholder="You know what to do."
          />
          <label
            class="search-form__label"
            for="search-posts"
            aria-label="search input for blog posts"
          ></label>
          <output class="search-form__results"></output>
        </form>
      </aside>
    </header>

    <section class="section__post mt-2">
      <aside class="post-index"></aside>

      <main class="post-content">
        <header class="post-header post-header--bash">
          <h2 class="post-title" href="#">Basic Authentication With Nginx</h2>
          <svg aria-hidden="true">
            <use xlink:href="../assets/images/sprite.svg#icon-nginx"></use>
          </svg>
        </header>

        <p>
          MongoDB is a scalable, high-performance, open source,
          document-oriented NoSQL database. It supports a large number of
          languages and application development platforms, and has a multitude
          of features including replication for redundancy and high availability
          and sharding for horizontal scaling.
        </p>

        <h3>BSON</h3>

        <p>
          This is the format used by MongoDB to store data and is very similar
          to JSON in how it is written and displayed, although it really is a
          binary format. This has the advantage of being really easy to use and
          adopt in applications already relying on JSON format while still
          making it an efficient solution for long term storage. The main
          advantages over JSON are the additional number of data types
          supported, such as date objects; it’s efficient to store large amounts
          of data and send over the network; and is very fast to write and
          compare data which makes it easy for consuming data in applications.
          Reading is a bit slower since the binary data has to be decoded first,
          but for quick scans for comparison and filtering is a better match.
        </p>

        <h3>CRUD operations</h3>

        <p>
          The basic functions that every data oriented application should be
          able to do. In a REST environment each of the Create, Read, Update and
          Delete operations correlate directly to the HTTP verbs POST, GET, PUT
          and DELETE although these may vary depending on the project or company
          guidelines.
        </p>

        <p>
          This will add a few documents into the
          <strong>robots</strong> collection, each containing a
          <em>name</em> and a <em>model</em>. If we run a quick search for these
          robots we will see that each has automatically been assigned an id:
        </p>

        <p>
          With MongoDB documents don’t have to adhere to a predefined schema and
          so we can have different fields specific to that document if we wanted
          to. Let’s update one of these documents:
        </p>

        <p>
          The first argument is the matching criteria for the document we want
          to update and the second argument contains the operation we want to
          make, along with the data that should be included. If the field
          specified does not exist like in this example it will be created.
        </p>

        <p>
          In addition to <code>updateOne</code> there’s
          <code>updateMany</code> which works exactly the same, it requires an
          object with some matching criteria and the data to be updated. The
          main difference is that the former will update only one document, the
          first it finds, whereas the latter will go through every document and
          update every single one if finds. There’s another method called simply
          <code>update</code> that will completely overwrite the document with
          the field(s) specified. For this purpose is best to use
          <code>replaceOne</code> which is more explicit. Notice that when
          replacing a document the <strong>_id</strong> does not change, it’s
          only the data contained in that document.
        </p>

        <p>
          Next up there is <code>deleteOne</code> and
          <code>deleteMany</code> which work pretty much in the same way except
          there’s no need to pass along any extra information, only the matching
          criteria for deletion. Note that the <strong>_id</strong> field is
          unique and you must provide not just a string with the correct
          identifier, but an <strong>ObjectId</strong> object like so:
        </p>

        <p>
          And finally the last operation is to read data using
          <code>findOne</code> and <code>find</code> (not findMany, just find).
          As we saw above running <code>find({})</code> returned all of the
          results available and that’s because an empty object is equivalent to
          a wildcard where every document is a match, same as
          <code>*</code> works in SQL databases.
        </p>

        <h3>Query Operators</h3>

        <p>
          Beyond the basic use of a key-value pair used to find documents while
          querying the database, there are
          <a href="https://docs.mongodb.com/manual/reference/operator/query/"
            >some specific operators</a
          >
          that can be used to retrieve results based on custom logic. To see
          this in practice let’s include an array with the movies these robots
          have appeared in.
        </p>

        <p>
          It’s pretty small dataset but will do to show a couple of examples.
          For instance we could search for robots that have appeared in a given
          movie by using the <code>$in</code> operator that will search for a
          value within the films array:
        </p>

        <p>
          In this case the search criteria will match any robot that has
          appeared in either of the films provided. More specifically, if they
          contain a field of type array with any of the values provided, so
          we’re not restricted to strings only. Another example where this can
          be useful is if we need to query blog posts based on the categories or
          tags is included in.
        </p>

        <p>
          Another operator we can use is the <code>$size</code> operator for
          comparing the length of an array. For instance we could take a look at
          all documents that have appeared in exactly 1 movie:
        </p>

        <p>
          Unfortunately we cannot provide <code>$size</code> with anything other
          than a number. If we wanted to query the robots collection for every
          document that has more than 3 movies but less than 9, we couldn’t do
          this right away. Instead we can create an additional
          <code>numberOfMovies</code> field for every document that is updated
          whenever we add or remove a movie. That way we can take advantage of
          the <code>$lt</code> and <code>$gt</code> operators:
        </p>

        <p>
          But this is not quite what we want, we’re querying the database twice
          and the data retrieved still needs further processing to contain only
          the results we want (robots that have appeared in more then 3 movies
          and less than 9). We can however combine these two queries together
          using the <code>$and</code> operator. It simply takes an array with
          two or more objects containing some filtering criteria:
        </p>

        <p>
          This type of query can also be expressed using an implicit
          <em>and</em> as follows:
        </p>

        <h3>Projection</h3>

        <p>
          And let’s look at a final example using <strong>projection</strong>.
          So far we’ve learned how to retrieve a document from the database
          based on some custom logic. However we may not always need all the
          information contained in that document. For instance when we looked
          which robots appeared in more than 3 movies but less than 9, we may
          not care exactly which movies and so the <em>movies</em> array is
          unnecessary for us, yet it is send through the network slowing things
          down a bit. Again, for this small example this is really insignificant
          but we may be querying a huge database or some other field may contain
          information that is expensive to compute.
        </p>

        <p>
          And so <strong>projection</strong> will let us choose which fields
          we’d like to retrieve by simply adding a second parameter to the
          <code>find</code> or <code>findOne</code> commands, specifying which
          fields we want and which we do not. Let’s follow the example I
          mentioned above:
        </p>

        <p>
          The second parameter of the <code>find</code> command tells MongoDB to
          only return that field. A value of 1 means true and 0 means false, so
          instead of returning only 1 value we could also simply drop a specific
          value from the results (in case we needed all but, say, the movies
          array even though this may not make sense for this example).
        </p>

        <p>
          Notice how the <strong>_id </strong>field was still retrieved even
          when we didn’t specify it. That’s just how MongoDB works, it’s a
          special field that gets special treatment so you must be explicit
          about it if you do not want to send it back:
        </p>

        <h3>Update Operators</h3>

        <p>
          Did you notice that the field naming is not consistent
          <em>i.e., films and numberOfMovies</em>? We can change any field name
          with the <code>$rename</code> operator to fix that. In this example we
          know that all documents have a field named <em>films</em> but that may
          not always be true, so we’re going to be explicit about this and make
          sure we only modify documents with that field name using the
          <code>$exists</code> operator (which to be clear, is a query
          operator).
        </p>
      </main>
    </section>

    <footer id="contact" class="section__footer">
      <h2 class="section__title">Thanks for visiting!</h2>
      <p>
        If you'd like to know more about me or this site please don't hesitate
        to contact me and visit my GitHub page.
      </p>
      <ul class="section__footer-icons">
        <li class="tooltip" data-tooltip="GitHub">
          <a
            href="https://github.com/herokunt"
            target="_blank"
            aria-label="external link to a github profile"
          >
            <svg aria-hidden="true">
              <use
                xlink:href="../assets/images/sprite.svg#icon-github-light"
              ></use>
            </svg>
          </a>
        </li>

        <li class="tooltip" data-tooltip="devsojourn@pm.me">
          <a
            href="mailto:devsojourn@pm.me"
            target="_blank"
            aria-label="link to send an email"
          >
            <svg aria-hidden="true">
              <use xlink:href="../assets/images/sprite.svg#icon-envelope"></use>
            </svg>
          </a>
        </li>

        <li class="tooltip" data-tooltip="PGP">
          <a
            href="publickey.devsojourn@pm.me.asc"
            download
            aria-label="downloads a pgp public key file"
          >
            <svg aria-hidden="true">
              <use xlink:href="../assets/images/sprite.svg#icon-key1"></use>
            </svg>
          </a>
        </li>
      </ul>
    </footer>
  </body>
</html>
